 # 数据库系统

 ## 1. 产生背景

数据管理技术在应用需求和计算机软硬件发展的基础上，经历了三个阶段：人工管理阶段、文件系统阶段、数据库系统阶段。数据库系统阶段的时间为20世纪60年代-至今。

数据库系统（DBS）由数据库(DB)、数据库管理系统（DBMS）和用户等组成。

数据库系统的特点在于：

+ 采用数据模型表示复杂的数据结构，减少数据冗余。
+ 有较高的数据独立性，数据的逻辑结构和物理结构可分离。
+ 方便用户的使用。
+ 提供了数据控制功能，实现并发控制、恢复能力，保证数据完整性、安全性等。

## 2. 发展

数据库通常分为层次式数据库、网络式数据库和关系式数据库三种，按不同的数据结构来联系和组织的。

关系型数据库：虽然网状数据库和层次数据库已经很好的解决了数据的集中和共享问题，但是在数据库独立性和抽象级别上扔有很大欠缺。用户在对这两种数据库进行存取时，仍然需要明确数据的存储结构，指出存取路径。而关系型数据库就可以较好的解决这些问题。

NoSQL，泛指非关系型的数据库。随着互联网web2.0网站的兴起，传统的关系数据库在应付web2.0网站，特别是超大规模和高并发的SNS类型的web2.0纯动态网站已经显得力不从心。NoSQL数据库在特定的场景下可以发挥出难以想象的高效率和高性能，它是作为对传统关系型数据库的一个有效的补充。

## 3. 分类

常见的数据库模型可分为关系型数据库（RDS，SQL），非关系型数据库（NoSQL）两大类。

下面列举了一些常见的非关系型数据库：
* 键值型数据库
* 文档型数据库
* 列存数据库
* 图数据库
* 时序数据库

### 3.1 关系型数据库

关系型数据库，是指采用了关系模型来组织数据的数据库，其以行和列的形式存储数据，以便于用户理解，关系型数据库这一系列的行和列被称为表，一组表组成了数据库。用户通过查询来检索数据库中的数据，而查询是一个用于限定数据库中某些区域的执行代码。关系模型可以简单理解为二维表格模型，而一个关系型数据库就是由二维表及其之间的关系组成的一个数据组织。

#### 3.1.1 特点

关系型数据库区别于其他数据库的特点在于：

+ 传统的关系型数据库采用表格的储存方式，数据以行和列的方式进行存储，要读取和查询都十分方便。
+ 由于数据的形式和内容在存入数据之前就已经定义好了，所以整个数据表的可靠性和稳定性都比较高，但带来的问题就是一旦存入数据后，如果需要修改数据表的结构就会十分困难。
+ 随着数据表数量的增加，数据管理会越来越复杂。
+ 拓展空间一定有非常有限的，关系型数据库只具备纵向扩展能力。
+ 关系型数据库采用结构化查询语言（即SQL）来对数据库进行查询，它能够支持数据库的CRUD操作，具有非常强大的功能，SQL可以采用类似索引的方法来加快查询操作。


#### 3.1.2 设计原则

关系型数据库在设计时应该遵守一定的规则，即数据库的范式理论。数据库的数据是一切操作的基础，如果数据库设计不好，利用其它方法来提高数据库性能的效果都是有限的。

在进行关系型数据库的设计过程中，要遵循以下几个原则，借此可以提高数据库的存储效率、数据完整性和可扩展性。

+ 命名规范化
+ 数据的一致性和完整性
+ 数据冗余尽可能少
+ 范式理论

#### 3.1.3 常用关系型数据库

关系型数据库是数据库的经典模型，不少数据库仍然是关系型数据库。

+ Oracle
+ MySQL
+ Microsoft SQL Server

#### 3.1.4 比较

可以大致将数据库类型分为关系型数据库和非关系型数据库，在其中我们选取了几个比较有代表意义的数据库进行对比。

一、与文档型数据库

面向文档数据库会将数据以文档形式存储。在文档型数据库中，每个JSON文档的ID就是它唯一的键，这也大致相当于关系型数据库中的主键。通常ID在一个数据库“集合”中是唯一的。一些NoSQL数据库会用ID排序，那么相近ID的数据自然更容易被检索到，经常需要一起调用的数据放在一起可以大大提升处理的速度。

面对大量而多样性的数据，如果使用关系型模型，就需要不断你的修改数据操作模式，这样，可能会引起系统负载的大大提升，同时也会大大增加处理的时间。 文档型模型存储就凸显其优点了，面对复杂多变的数据，使用文档型模型就直接保留了原有数据的样貌，不需要另外创建新的表新的操作模式来处理。

二、与KV数据库

kv数据库是指Key-value数据库，是一种以键值对存储数据的一种数据库，类似java中的map。可以将整个数据库理解为一个大的map，每个键都会对应一个唯一的值。

key-value分布式存储系统相比关系型数据库，查询速度快、存放数据量大、支持高并发，非常适合通过主键进行查询，主要使用一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据，但不能进行复杂的条件查询。

三、与图数据库

图数据库应用图形理论存储实体之间的关系信息。关系型数据库用于存储“关系型”数据的效果并不好，其查询复杂、缓慢、超出预期，而图形数据库的独特设计恰恰弥补了这个缺陷。

相对于关系数据库中的各种关联表，图形数据库中的关系可以通过关系能够包含属性这一功能来提供更为丰富的关系展现方式。因此相较于关系型数据库，图形数据库的用户在对事物进行抽象时将拥有一个额外的武器，那就是丰富的关系。

产品：Oracl、MySQL

### 3.2 文档型数据库

#### 3.2.1 简介

面向文档的数据库，或文档存储，是用于存储，检索和管理面向文档的信息的数据库系统。

文档数据库以文档的形式存储数据，例如

```c++
{Name="Test User",Address="Address1",Age:8}
```

文档是由键值对组成的。尽管可以将一个文档比作关系型数据库中的一行，但不用于行的是，文档具有灵活的模式。

面向文档的数据库是[NoSQL](https://en.wikipedia.org/wiki/NoSQL)数据库的主要类别之一。面向文档的数据库本质上是[键值存储](https://en.wikipedia.org/wiki/Key-value_database)的子类，他们的不同之处在于处理数据的方式；在KV数据库中，数据被认为是透明的，数据库系统并不知道数据的语义等信息；而文档数据库中，提供了额外的元数据来组织数据。

面向文档的数据库的核心概念是文档。虽然每个面向文档的数据库实现在此定义的细节上有所不同，但总的来说，它们都假设文档以某种标准格式或编码封装和编码数据（或信息）。使用的编码包括[XML](https://en.wikipedia.org/wiki/XML)、[YAML](https://en.wikipedia.org/wiki/YAML)、[JSON](https://en.wikipedia.org/wiki/JSON)以及像[BSON](https://en.wikipedia.org/wiki/BSON)这样的二进制形式。

#### 3.2.2 文档

文档存储中的文档大致相当于编程中对象的概念。它们不需要遵循标准模式，文档存储允许在单个存储系统中存储不同类型的文档，并且允许其中的字段是可选的，也允许使用不同的编码系统对它们进行编码。

例如，以下是一个以 JSON 编码的文档：

```json
{ 
    "FirstName" :  "Bob" ,  
    "Address" :  "5 Oak St." ,  
    "爱好" :  "航海" 
}
```

XML文档的示例为：

```xml
<contact> 
    <firstname> Bob </firstname> 
    <lastname> Smith </lastname> 
    <phone  type= "Cell" > (123) 555-0178 </phone> 
    <phone  type= "Work" > (890) 555- 0133 </phone> 
    <address> 
      <type> Home </type> 
      <street1> 123 Back St. </street1> 
      <city> Boys </city> 
      <state> AR </state> 
      <zip> 32225 </zip > 
      <country>US</country> 
    </address> 
  </contact>
```

文档数据库可以检索、存储和管理面向文档的信息。

这种半结构化数据可以应对关系型数据库难以应对的挑战：

* 当数据库需要更改其模型时，关系型数据库需要数据库管理员接入，对于快速增长的数据和数据组织形式，新公司难以承受低效率。
* 具有行和列的数据结构不适合现代敏捷软件开发的适应性流程和快速软件交付。
* 关系模型扁平的数据结构——行和列不是存储数据的自然方式。特别是组织面向对象的数据时，将其划分为列不太灵活。

#### 3.2.3 与关系型数据库有何不同

**功能**

文档数据库在功能上与传统的关系数据库 有很大的不同。

关系数据库通常将数据存储在单独的表（由程序员定义）中，允许单个对象分布在多个表中。但是，在文档数据库中，给定文档或对象的所有信息都存储在单个实例中——在将数据加载到数据库中或检索事物时，无需进行对象关系映射。

由于这个原因，文档数据库通常更快，尽管这取决于您如何使用它。

**灵活的模式**

与表格模型不同，文档存储具有动态的自描述模式，可适应变化。无需预先定义它是数据库。值和字段可以在不同的文档中交替；在任何阶段修改设计，而不会从根本上破坏其结构——不需要模式迁移。注意：一些文档存储允许 JSON 模式，让您设置管理文档结构的管理规则。

**更适合敏捷开发人员**

由于直观的数据模型， 面向文档的数据库对开发人员来说更快、更容易。代码中的对象可以映射到文档，使它们处理起来更直观。跨表的数据分解是必要的，同时也不需要集成单独的 ORM 层或使用高代价的 JOIN。

**强大的查询功能**

以灵活的方式查询，具有表现力的查询语言和多方面的索引功能。这是关系数据库和文档存储之间的本质区别。查询语言具有综合能力，让您以您认为最好的方式处理数据。全时聚合、即席查询和索引是处理、修改和检索数据的深层方法。ACID 事务让您保留您习惯于在 SQL 数据库中拥有的保证，无论是在单个文档中还是在多个分片中操作数据。

**广泛兼容**

JSON 文档在每个角落都有使用。作为一种独立于语言、人类可读且非数据密集型的标准，JSON 被广泛用于数据交换和存储。请记住，文档存储是其他现有数据模型的子集或超集，这意味着您可以按照应用程序需要的方式编码数据——键值对；丰富的物品；桌子；地理空间和时间序列数据；和图形边缘/节点。在文档中工作只需要一种查询语言，无论您选择什么数据模型，都可以为您的开发工作流程增加一致性。

**分布式系统**

分布式系统提高了数据的大规模可扩展性和弹性。虽然关系数据库有一个更加单一的框架和增量扩展，但文档数据库本质上是一种分布式系统。每个文档都是一个独立的单元，更容易跨服务器分布，而不会破坏数据本地性。使用具有自我修复恢复功能的复制来保持应用程序的高可用性。这还允许将集群中的多个工作负载彼此隔离。本机启动允许应用程序透明、弹性水平扩展，以促进工作负载扩展。

#### 3.2.4 文档数据库系统

**MongoDB**

MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似 json的bjson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几 乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。

**CouchDB**

Apache CouchDB 是一个面向文档的数据库管理系统。它提供以 JSON 作为数据格式的 REST 接口来对其进行操作，并可以通过视图来操纵文档的组织和呈现。

### 3.3 键值型数据库

键值数据库就类似传统语言中使用的哈希表。可以通过key来添加、查询或者删除数据库，因为使用key主键访问，所以会获得很高的性能及扩展性。

键值数据库主要使用一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。Key/value模型对于IT系统来说的优势在于简单、易部署、高并发。

产品：Memcached、Redis、MemcacheDB

### 3.4 图数据库

图数据库是**NoSQL数据库**的一种类型，它应用**图**存储实体之间的关系信息。

关系型数据库用于存储“关系型”数据的效果并不好，其查询复杂、缓慢，而图形数据库的独特设计恰恰弥补了这个缺陷。

|          |          关系型数据库          |             图数据库             |
| :------: | :----------------------------: | :------------------------------: |
| 存储模型 |   用二维表存储实体与关系信息   | 用点与边的集合存储实体与关系信息 |
| 查询模型 |    基于扫描行、过滤行与聚合    | 基于点边组成路径的遍历与中间计算 |
| 分析类型 | 适用于简单数据查找与描述性统计 |    适用于关联分析与预测性分析    |
| 实时查询 |    物理隔离的表建立关联较慢    |  基于图的结构，关联扩展响应极快  |

#### 3.4.1 **图数据库应用场景**

社交网络、实时推荐系统、知识图谱、地理空间管理、反欺诈

**应用场景**对比举例：

假设一个资金流存在嫌疑，经过多个账户中转，最后回到本身账户，需要查明流经路径。

关系型数据库：很难通过SQL直接实现业务查询需求，需要结合业务规则和算法模型。

图数据库：通过简单自然的建模与图查询语句直接查询 ，更符合人类直觉。

图数据库的**开发流程**：定义图模式--->加载数据--->创建查询--->测试查询--->服务上线


### 4. 总结

 ## TODO：

